# Tests

Tests are in the form of binary files and represent input for the emulator.

In bin_files there are the binary of the instructions supported by the emulator, downloaded from the repository https://github.com/riscv/riscv-tests.

## Generate new tests

It's possible to generate new tests using the gnu toolchain, installation guide follows. 

### Linux 

Clone the repository and compile the files with the gnu riscv compiler, resources at https://github.com/riscv-collab/riscv-gnu-toolchain.git.

    git clone https://github.com/riscv/riscv-tests
    cd riscv-tests
    git submodule update --init --recursive
    autoconf
    ./configure
    make
    make install
    cd ..

The directory contains executable and .dump files in order to make the binaries needed to run the emulator execute the gen_test.py script:

    ./gen_test.py

### Windows 
So far (01/09/2023) there's no gnu toolchain for Windows, therefore the only available binaries are the ones precompiled in bin_files.
For the same reason the dump_files directory contains the dump files needed by check_correctness script.

## Execution 

Every binary file is divided into blocks of instructions representing a different test except for the two last blocks whose first instruction
is marked as success and fail, respectively.

Each block ends with a conditional jump that is taken if the processor status, based on the previous instructions, doesn't match the expected result,
otherwise the next test is executed.
Such jumps lead to the fail instruction, meaning the processor has problems.
If nothing went wrong the success block would be executed, meaning the processor has passed all tests. 

*Check_correctness.py* runs the executable in the mode specified (i.e Release or Debug) and checks the presence of \<pass\>  instruction address and the absence of \<fail\> in the output generated by the emulator.

For each test the script also measures the amount of time spent to execute the instructions and, if all tests are passed, displays all measurements in a graph.

